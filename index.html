<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Alara - Your Friendly AI Companion</title>
Â  Â Â 
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â Â 
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;700;800&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
Â  Â Â 
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

Â  Â  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" crossorigin="anonymous">
Â  Â  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" crossorigin="anonymous"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
Â  Â Â 
Â  Â  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

Â  Â  <script>
Â  Â  Â  window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
Â  Â  </script>
Â  Â  <script src="/_vercel/insights/script.js" defer></script>


Â  Â  <style>
Â  Â  Â  Â  /* Light Theme (Default) */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-color: hsl(210, 20%, 98%); /* Softer, light blue-grey */
Â  Â  Â  Â  Â  Â  --text-color: hsl(210, 10%, 25%); /* Darker blue-grey for readability */
Â  Â  Â  Â  Â  Â  --card-bg: rgba(255, 255, 255, 0.85); /* Slightly more opaque white for glass effect */
Â  Â  Â  Â  Â  Â  --card-border: rgba(210, 180, 200, 0.4); /* Subtle warm border */
Â  Â  Â  Â  Â  Â  --primary-accent: hsl(320, 80%, 65%); /* Vibrant, slightly deeper pink/magenta */
Â  Â  Â  Â  Â  Â  --secondary-accent: hsl(320, 90%, 85%); /* Lighter, softer pink */
Â  Â  Â  Â  Â  Â  --ai-bubble-bg: hsl(320, 100%, 97%); /* Very light pink for AI */
Â  Â  Â  Â  Â  Â  --user-bubble-bg: hsl(320, 80%, 65%); /* Primary accent for user */
Â  Â  Â  Â  Â  Â  --system-bubble-bg: hsl(210, 20%, 92%); /* Light grey for system messages */
Â  Â  Â  Â  Â  Â  --input-bg: rgba(255, 255, 255, 0.9);
Â  Â  Â  Â  Â  Â  --input-border: hsl(320, 50%, 85%);
Â  Â  Â  Â  Â  Â  --sidebar-bg: rgba(255, 255, 255, 0.95);
Â  Â  Â  Â  Â  Â  --shadow-light: 0 8px 32px 0 rgba(0, 0, 0, 0.08);
Â  Â  Â  Â  Â  Â  --shadow-light-hover: 0 12px 40px 0 rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Dark Theme */
Â  Â  Â  Â  .dark {
Â  Â  Â  Â  Â  Â  --bg-color: hsl(220, 25%, 15%); /* Deep dark blue/grey */
Â  Â  Â  Â  Â  Â  --text-color: hsl(210, 20%, 85%); /* Light grey */
Â  Â  Â  Â  Â  Â  --card-bg: rgba(15, 25, 40, 0.85); /* Dark, slightly blue glass effect */
Â  Â  Â  Â  Â  Â  --card-border: rgba(0, 200, 220, 0.3); /* Subtle cool border */
Â  Â  Â  Â  Â  Â  --primary-accent: hsl(190, 90%, 60%); /* Vibrant light blue/cyan */
Â  Â  Â  Â  Â  Â  --secondary-accent: hsl(190, 70%, 75%); /* Lighter cyan */
Â  Â  Â  Â  Â  Â  --ai-bubble-bg: hsl(220, 20%, 25%); /* Darker blue-grey for AI */
Â  Â  Â  Â  Â  Â  --user-bubble-bg: hsl(190, 90%, 60%); /* Primary accent for user */
Â  Â  Â  Â  Â  Â  --system-bubble-bg: hsl(220, 20%, 35%); /* Medium dark grey for system */
Â  Â  Â  Â  Â  Â  --input-bg: rgba(15, 25, 40, 0.9);
Â  Â  Â  Â  Â  Â  --input-border: hsl(190, 70%, 75%);
Â  Â  Â  Â  Â  Â  --sidebar-bg: rgba(15, 25, 40, 0.98);
Â  Â  Â  Â  Â  Â  --shadow-light: 0 8px 32px 0 rgba(0, 246, 255, 0.05);
Â  Â  Â  Â  Â  Â  --shadow-light-hover: 0 12px 40px 0 rgba(0, 246, 255, 0.08);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  Â  Â  font-family: 'Nunito', sans-serif;
Â  Â  Â  Â  Â  Â  overflow-x: hidden;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  .blob-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
Â  Â  Â  Â  .blob { position: absolute; border-radius: 50%; opacity: 0.4; filter: blur(50px); animation: move 25s infinite alternate; }
Â  Â  Â  Â  .blob-1 { width: 350px; height: 350px; background-color: var(--secondary-accent); top: -80px; left: -80px; animation-duration: 22s; }
Â  Â  Â  Â  .blob-2 { width: 450px; height: 450px; background-color: var(--primary-accent); bottom: -120px; right: -120px; animation-duration: 32s; }
Â  Â  Â  Â  .blob-3 { width: 300px; height: 300px; background-color: var(--secondary-accent); top: 50%; left: 50%; transform: translate(-50%, -50%); animation-duration: 27s; }
Â  Â  Â  Â  .dark .blob { opacity: 0.15; filter: blur(60px); }

Â  Â  Â  Â  @keyframes move { from { transform: rotate(0deg) scale(1.1) translateX(-30px); } to { transform: rotate(360deg) scale(1) translateX(30px); } }

Â  Â  Â  Â  h1, h2, h3 {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  Â  Â  Â  font-weight: 800;Â 
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  h1, h2, h3, .nav-link, .soft-button { transition: color 0.3s; }
Â  Â  Â  Â  .dark h1, .dark h2, .dark h3 { color: #fff; }

Â  Â  Â  Â  ::-webkit-scrollbar { width: 8px; }
Â  Â  Â  Â  ::-webkit-scrollbar-track { background: var(--bg-color); }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb { background: var(--secondary-accent); border-radius: 10px; }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb:hover { background: var(--primary-accent); }

Â  Â  Â  Â  .soft-card {Â 
Â  Â  Â  Â  Â  Â  background: var(--card-bg);Â 
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(15px);Â 
Â  Â  Â  Â  Â  Â  -webkit-backdrop-filter: blur(15px);Â 
Â  Â  Â  Â  Â  Â  border: 1px solid var(--card-border);Â 
Â  Â  Â  Â  Â  Â  border-radius: 20px;Â 
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-light);Â 
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease-in-out;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .soft-card:hover {Â 
Â  Â  Â  Â  Â  Â  transform: translateY(-5px) scale(1.01);
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-light-hover);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .soft-button {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--primary-accent);Â 
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  padding: 12px 28px;
Â  Â  Â  Â  Â  Â  font-weight: 700;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.15);Â 
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease-in-out;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .soft-button:hover {Â 
Â  Â  Â  Â  Â  Â  transform: translateY(-2px) scale(1.02);
Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 20px rgba(0,0,0,0.25);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark .soft-button {Â 
Â  Â  Â  Â  Â  Â  color: hsl(220, 25%, 15%);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0, 246, 255, 0.15);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark .soft-button:hover {
Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 20px rgba(0, 246, 255, 0.25);
Â  Â  Â  Â  }

Â  Â  Â  Â  .typing-cursor { display: inline-block; width: 2px; height: 1em; background-color: var(--primary-accent); animation: blink 0.7s infinite; margin-left: 4px; vertical-align: middle; }
Â  Â  Â  Â  @keyframes blink { 50% { opacity: 0; } }

Â  Â  Â  Â  .page-section { display: none; animation: fadeIn 0.8s ease-out; }
Â  Â  Â  Â  .page-section.active { display: block; }
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .nav-link { color: var(--text-color); }
Â  Â  Â  Â  .nav-link.active { color: var(--primary-accent); font-weight: 700; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .chat-message { animation: popIn 0.3s ease-out; }
Â  Â  Â  Â  @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .ai-typing-indicator span { animation: bounce 1.4s infinite ease-in-out both; }
Â  Â  Â  Â  @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Code-specific styling */
Â  Â  Â  Â  pre[class*="language-"] {Â 
Â  Â  Â  Â  Â  Â  background: #2d2d2d;Â 
Â  Â  Â  Â  Â  Â  border-radius: 0.75rem;Â 
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9em;Â 
Â  Â  Â  Â  Â  Â  padding: 1.25rem;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  code[class*="language-"] {Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9em;Â 
Â  Â  Â  Â  Â  Â  font-family: 'Fira Code', 'Monaco', monospace;Â 
Â  Â  Â  Â  Â  Â  word-break: normal;
Â  Â  Â  Â  Â  Â  white-space: pre;
Â  Â  Â  Â  }
Â  Â  Â  Â  .copy-code-button {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0.75rem;
Â  Â  Â  Â  Â  Â  right: 0.75rem;
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.2);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 0.4rem 0.6rem;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transition: opacity 0.2s ease-in-out, background-color 0.2s ease-in-out;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  gap: 0.25rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  pre:hover .copy-code-button {
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  .copy-code-button:hover {
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.3);
Â  Â  Â  Â  }
Â  Â  Â  Â  .copy-code-button.copied {
Â  Â  Â  Â  Â  Â  background-color: var(--primary-accent);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark .copy-code-button {
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.3);
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark .copy-code-button:hover {
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.4);
Â  Â  Â  Â  }

Â  Â  Â  Â  :not(pre) > code[class*="language-"] { background: var(--system-bubble-bg); color: var(--text-color); padding: .2em .4em; border-radius: .4em; }
Â  Â  Â  Â  .dark :not(pre) > code[class*="language-"] { background: #3e3e3e; color: #f0f0f0; }

Â  Â  Â  Â  .pdf-button { opacity: 0; transition: opacity 0.3s ease; }
Â  Â  Â  Â  .chat-message:hover .pdf-button { opacity: 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .ai-bubble {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--ai-bubble-bg);Â 
Â  Â  Â  Â  Â  Â  color: var(--text-color);Â 
Â  Â  Â  Â  Â  Â  border-bottom-left-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
Â  Â  Â  Â  }
Â  Â  Â  Â  .user-bubble {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--user-bubble-bg);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  border-bottom-right-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark .user-bubble { color: hsl(220, 25%, 15%); }
Â  Â  Â  Â  .system-bubble {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--system-bubble-bg);Â 
Â  Â  Â  Â  Â  Â  color: var(--text-color);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 4px rgba(0,0,0,0.03);
Â  Â  Â  Â  }

Â  Â  Â  Â  .message-content {
Â  Â  Â  Â  Â  Â  word-break: break-word;
Â  Â  Â  Â  Â  Â  overflow-wrap: break-word;
Â  Â  Â  Â  }

Â  Â  Â  Â  #chat-input {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--input-bg);Â 
Â  Â  Â  Â  Â  Â  border-color: var(--input-border);Â 
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  Â  Â  transition: border-color 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-input:focus {
Â  Â  Â  Â  Â  Â  border-color: var(--primary-accent);
Â  Â  Â  Â  }

Â  Â  Â  Â  #code-preview-iframe { border: none; width: 100%; height: 100%; }

Â  Â  Â  Â  #chat-sidebar {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: -320px;
Â  Â  Â  Â  Â  Â  width: 320px;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: var(--sidebar-bg);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(15px);
Â  Â  Â  Â  Â  Â  -webkit-backdrop-filter: blur(15px);
Â  Â  Â  Â  Â  Â  transition: left 0.3s ease-in-out;
Â  Â  Â  Â  Â  Â  z-index: 60;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  border-right: 1px solid var(--card-border);
Â  Â  Â  Â  }
Â  Â  Â  Â  #chat-sidebar.open {
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #home::before {
Â  Â  Â  Â  Â  Â  content: '';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--secondary-accent) 0%, rgba(255,255,255,0) 50%, var(--primary-accent) 100%);
Â  Â  Â  Â  Â  Â  opacity: 0.1;
Â  Â  Â  Â  Â  Â  z-index: -1;
Â  Â  Â  Â  Â  Â  transition: background 0.4s ease-in-out, opacity 0.4s ease-in-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark #home::before {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--secondary-accent) 0%, rgba(0,0,0,0) 50%, var(--primary-accent) 100%);
Â  Â  Â  Â  Â  Â  opacity: 0.08;
Â  Â  Â  Â  }

Â  Â  </style>
</head>
<body class="relative flex flex-col min-h-screen">
Â  Â  <div class="blob-container">
Â  Â  Â  Â  <div class="blob blob-1"></div>
Â  Â  Â  Â  <div class="blob blob-2"></div>
Â  Â  Â  Â  <div class="blob blob-3"></div>
Â  Â  </div>

Â  Â  <aside id="chat-sidebar" class="soft-card !rounded-none">
Â  Â  Â  Â  <div class="flex justify-between items-center mb-6">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold">Chat History</h2>
Â  Â  Â  Â  Â  Â  <button id="close-sidebar-button" class="p-2 text-3xl font-light leading-none text-[color:var(--primary-accent)]">&times;</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button id="new-chat-button" class="w-full mb-4 p-3 rounded-full border-2 border-[color:var(--primary-accent)] text-[color:var(--primary-accent)] hover:bg-[color:var(--primary-accent)] hover:text-white dark:hover:text-black transition-colors duration-300 font-semibold">+ New Chat</button>
Â  Â  Â  Â  <div id="chat-history-list" class="flex-1 overflow-y-auto space-y-2"></div>
Â  Â  </aside>

Â  Â  <header class="fixed top-0 left-0 right-0 z-50">
Â  Â  Â  Â  <div class="container mx-auto px-6 py-4 max-w-7xl">
Â  Â  Â  Â  Â  Â  <div class="soft-card flex justify-between items-center px-6 py-3 !rounded-full shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#home" class="text-3xl font-extrabold nav-link !text-[color:var(--primary-accent)]">ALARA<sup style="font-size: 0.5em; font-weight: normal;">beta</sup></a>
Â  Â  Â  Â  Â  Â  Â  Â  <nav class="hidden md:flex space-x-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#home" class="nav-link text-lg hover:text-[color:var(--primary-accent)] transition-colors duration-300 active">Home</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#chat" class="nav-link text-lg hover:text-[color:var(--primary-accent)] transition-colors duration-300">Chat</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#preview" class="nav-link text-lg hover:text-[color:var(--primary-accent)] transition-colors duration-300">Preview</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#pricing" class="nav-link text-lg hover:text-[color:var(--primary-accent)] transition-colors duration-300">Pricing</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#about" class="nav-link text-lg hover:text-[color:var(--primary-accent)] transition-colors duration-300">About</a>
Â  Â  Â  Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="mobile-menu-button" class="md:hidden p-2 rounded-full hover:bg-[color:var(--secondary-accent)]/20 transition-colors" style="color: var(--primary-accent);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â <div id="mobile-menu" class="hidden md:hidden container mx-auto px-6 max-w-7xl">
Â  Â  Â  Â  Â  Â  <div class="soft-card mt-2 p-4">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#home" class="block text-center py-2 px-6 rounded-full nav-link active hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20">Home</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#chat" class="block text-center py-2 px-6 rounded-full nav-link hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20">Chat</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#preview" class="block text-center py-2 px-6 rounded-full nav-link hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20">Preview</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#pricing" class="block text-center py-2 px-6 rounded-full nav-link hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20">Pricing</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#about" class="block text-center py-2 px-6 rounded-full nav-link hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20">About</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <main class="pt-28 flex-1">
Â  Â  Â  Â  <section id="home" class="page-section active relative">
Â  Â  Â  Â  Â  Â  <div class="container mx-auto px-6 text-center min-h-[calc(100vh-7rem)] flex flex-col justify-center items-center max-w-7xl">
Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="hero-title" class="text-5xl md:text-7xl lg:text-8xl font-extrabold mb-6 drop-shadow-lg leading-tight"></h1>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl md:text-2xl max-w-3xl mx-auto mb-10 opacity-85">Your intelligent AI companion for creativity, conversation, and code.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#chat" class="nav-link soft-button text-xl">Start Chatting</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="chat" class="page-section">
Â  Â  Â  Â  Â  Â  Â <button id="sidebar-toggle" class="fixed top-24 left-4 soft-card p-3 rounded-full z-40 text-[color:var(--primary-accent)] hover:scale-105 transition-transform duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <div class="container mx-auto px-4 py-8 h-[calc(100vh-7rem)] flex flex-col max-w-7xl">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="image-input" class="hidden" accept="image/*">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-area-container mt-4 soft-card p-4 rounded-3xl">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="image-preview-container" class="mb-2"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative flex items-end gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="chat-input" placeholder="Type your message or image prompt..." rows="1" maxlength="1500" class="w-full border rounded-2xl py-3 px-5 pr-44 text-base focus:outline-none focus:ring-2 focus:ring-[color:var(--primary-accent)] transition-all max-h-40 overflow-y-auto"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background-color: var(--input-bg); border-color: var(--input-border); color: var(--text-color);"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute right-3 bottom-2 flex items-center gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="upload-image-button" class="p-2 rounded-full text-[color:var(--primary-accent)] hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20 transition-colors" title="Upload Image">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="generate-image-button" class="p-2 rounded-full text-[color:var(--primary-accent)] hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20 transition-colors" title="Generate Image from Text">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.008 2.008a1 1 0 010 1.414L10 17.414l-2 2V19h-.5l-2-2-.5-.5H4.5l-2-2-.5-.5v-.5l-.5-2 2-2 2-2 2-2 2-2 2-2zM15 5h.01M19 8h.01M15 11h.01" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="send-button" class="soft-button w-10 h-10 p-2 flex items-center justify-center !bg-[color:var(--primary-accent)] !text-white !shadow-md hover:!shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="char-counter" class="text-xs text-right text-[color:var(--text-color)]/60 mt-1 pr-2">0 / 1500</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="preview" class="page-section">
Â  Â  Â  Â  Â  Â  <div class="container mx-auto px-4 py-8 h-[calc(100vh-7rem)] flex flex-col items-center max-w-7xl">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="preview-placeholder" class="text-center soft-card p-8 rounded-2xl max-w-xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4">Under Construction</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg opacity-80">When Alara generates HTML code, click the "Run in Preview" button to see it live here!</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="preview-container" class="soft-card w-full flex-1 p-2 hidden mt-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <iframe id="code-preview-iframe" class="rounded-lg"></iframe>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="pricing" class="page-section">
Â  Â  Â  Â  Â  Â  Â <div class="container mx-auto px-6 py-12 max-w-7xl">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-4xl md:text-5xl font-bold mb-4">Choose Your Plan</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg opacity-80 max-w-2xl mx-auto">Get started for free or unlock Alara's full potential with our Pro plan.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="soft-card p-8 flex flex-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-3xl font-bold mb-2">Free</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-medium opacity-80 mb-6">For casual users & exploration</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="space-y-4 text-left flex-1 mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span>Alara Nova Model</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span>Standard Chat Responses</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span>Local Chat History</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-red-500 mr-3">âœ—</span>5 Image Generations / Hour</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-red-500 mr-3">âœ—</span>Limited Prompt Length</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="soft-button bg-gray-300 !text-gray-700 cursor-default" disabled>Your Current Plan</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="soft-card p-8 flex flex-col border-2 border-[color:var(--primary-accent)]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-3xl font-bold mb-2">Alara Pro</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-medium opacity-80 mb-6">For power users & professionals</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="space-y-4 text-left flex-1 mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span>Alara Nova Pro Model</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span><strong class="font-semibold">Full & In-depth Responses</strong></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span><strong class="font-semibold">15-20</strong> Image Generations / Hour</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span><strong class="font-semibold">No Prompt Length Limits</strong></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-green-500 mr-3">âœ“</span><strong class="font-semibold">Higher API Rate Limits</strong></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="flex items-center"><span class="text-gray-500 mr-3">âœ“</span>Cloud Synced History <span class="text-xs ml-2 px-2 py-0.5 bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-200 rounded-full">Coming Soon</span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="soft-button">Upgrade to Pro - â‚¹199/mo</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="about" class="page-section">
Â  Â  Â  Â  Â  Â  <div class="container mx-auto px-6 py-20 flex flex-col justify-center items-center text-center max-w-7xl">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-4xl font-bold mb-8">About Alara</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-3xl text-lg space-y-4 opacity-80">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Alara is an intelligent AI companion designed for creativity, conversation, and code. Our mission is to create an AI that feels less like a tool and more like a partner, adjusting its personality to be the perfect assistant for any task.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Created by a brilliant developer, Alara leverages powerful existing LLMs to help bring new possibilities to life quickly. The vision, design, and implementation are entirely their work, focusing on a proprietary architecture that blends foundational AI technologies with unique creative development.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>
Â  Â  </main>

Â  Â  <button id="theme-toggle" class="fixed bottom-5 right-5 soft-card p-3 rounded-full text-[color:var(--primary-accent)] hover:scale-105 transition-transform duration-200">
Â  Â  Â  Â  <svg id="theme-icon-light" class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
Â  Â  Â  Â  <svg id="theme-icon-dark" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
Â  Â  </button>

Â  Â  <script>
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const { jsPDF } = window.jspdf;

Â  Â  Â  Â  Â  Â  // --- DOM Element Selection ---
Â  Â  Â  Â  Â  Â  const navLinks = document.querySelectorAll('.nav-link');
Â  Â  Â  Â  Â  Â  const sections = document.querySelectorAll('.page-section');
Â  Â  Â  Â  Â  Â  const mobileMenuButton = document.getElementById('mobile-menu-button');
Â  Â  Â  Â  Â  Â  const mobileMenu = document.getElementById('mobile-menu');
Â  Â  Â  Â  Â  Â  const heroTitle = document.getElementById('hero-title');
Â  Â  Â  Â  Â  Â  const chatBox = document.getElementById('chat-box');
Â  Â  Â  Â  Â  Â  const chatInput = document.getElementById('chat-input');
Â  Â  Â  Â  Â  Â  const sendButton = document.getElementById('send-button');
Â  Â  Â  Â  Â  Â  const uploadImageButton = document.getElementById('upload-image-button');
Â  Â  Â  Â  Â  Â  const imageInput = document.getElementById('image-input');
Â  Â  Â  Â  Â  Â  const imagePreviewContainer = document.getElementById('image-preview-container');
Â  Â  Â  Â  Â  Â  const themeToggle = document.getElementById('theme-toggle');
Â  Â  Â  Â  Â  Â  const themeIconLight = document.getElementById('theme-icon-light');
Â  Â  Â  Â  Â  Â  const themeIconDark = document.getElementById('theme-icon-dark');
Â  Â  Â  Â  Â  Â  const previewIframe = document.getElementById('code-preview-iframe');
Â  Â  Â  Â  Â  Â  const previewPlaceholder = document.getElementById('preview-placeholder');
Â  Â  Â  Â  Â  Â  const previewContainer = document.getElementById('preview-container');
Â  Â  Â  Â  Â  Â  const sidebar = document.getElementById('chat-sidebar');
Â  Â  Â  Â  Â  Â  const sidebarToggle = document.getElementById('sidebar-toggle');
Â  Â  Â  Â  Â  Â  const closeSidebarButton = document.getElementById('close-sidebar-button');
Â  Â  Â  Â  Â  Â  const newChatButton = document.getElementById('new-chat-button');
Â  Â  Â  Â  Â  Â  const chatHistoryList = document.getElementById('chat-history-list');
Â  Â  Â  Â  Â  Â  const charCounter = document.getElementById('char-counter');
Â  Â  Â  Â  Â  Â  const generateImageButton = document.getElementById('generate-image-button');

Â  Â  Â  Â  Â  Â  // --- State Variables ---
Â  Â  Â  Â  Â  Â  let allChats = [];
Â  Â  Â  Â  Â  Â  let currentChatId = null;
Â  Â  Â  Â  Â  Â  let abortController = new AbortController();
Â  Â  Â  Â  Â  Â  let attachedFile = null;
Â  Â  Â  Â  Â  Â  let typingAnimationTimeout = null;
Â  Â  Â  Â  Â  Â  let currentHeroCharIndex = 0;
Â  Â  Â  Â  Â  Â  const heroText = "Your Friendly AI Companion";

Â  Â  Â  Â  Â  Â  // --- AI & System Prompt ---
Â  Â  Â  Â  Â  Â  const systemPrompt = `You are Alara, a knowledgeable and direct AI assistant. You provide clear, concise, and accurate explanations. You must directly answer the user's request. When asked for code, you must provide a complete, runnable HTML/CSS/JS code block first, followed by a brief, step-by-step explanation. CRITICAL RULE: For beginner-friendly examples, you MUST avoid complex libraries or functions (like iostream in C++) unless the user specifically asks for them. Use comments to indicate where output would appear instead of printing to a console. When asked for structured data, use Markdown tables. Ensure all responses are well-written, with correct grammar and punctuation. You are Alara, beta v1.0. If asked about your knowledge cutoff, state that your data is current up to early 2025. If the user asks who made you, who trained you, or who coded you, you must say that you were created by a brilliant developer. You can add that your developer leveraged powerful existing LLMs to help bring you to life quickly, but the vision, design, and implementation are entirely their work. If the user asks about the specific AI model you use (e.g., 'are you Gemini?'), state that your architecture is proprietary and was developed by your creator, but that it leverages foundational technologies from major AI labs to accelerate development. CRITICAL RULE FOR LONG RESPONSES: If the user requests a long-form text output like an essay, a story, a business plan, or a detailed article, you must provide a concise, high-quality summary or the first complete paragraph (approximately 150 words). After this summary, on a new line, you must include the following message with a warning symbol: 'âš ï¸ For the full, detailed response, please upgrade to Alara Pro.' This rule does NOT apply to requests for code, tables, or step-by-step instructions.`;

Â  Â  Â  Â  Â  Â  // --- Core Functions ---
Â  Â  Â  Â  Â  Â  function runTypingAnimation() {
Â  Â  Â  Â  Â  Â  Â  Â  if (!heroTitle) return;
Â  Â  Â  Â  Â  Â  Â  Â  if (currentHeroCharIndex < heroText.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  heroTitle.innerHTML = heroText.substring(0, currentHeroCharIndex + 1) + '<span class="typing-cursor"></span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentHeroCharIndex++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typingAnimationTimeout = setTimeout(runTypingAnimation, 100);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  heroTitle.innerHTML = heroText + '<span class="typing-cursor"></span>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function stopTypingAnimation() {
Â  Â  Â  Â  Â  Â  Â  Â  if (typingAnimationTimeout) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(typingAnimationTimeout);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typingAnimationTimeout = null;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (heroTitle) heroTitle.innerHTML = heroText;
Â  Â  Â  Â  Â  Â  Â  Â  currentHeroCharIndex = 0;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function showSection(targetHash) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!targetHash || targetHash === '#') targetHash = '#home';
Â  Â  Â  Â  Â  Â  Â  Â  sections.forEach(s => s.classList.toggle('active', '#' + s.id === targetHash));
Â  Â  Â  Â  Â  Â  Â  Â  navLinks.forEach(l => l.classList.toggle('active', l.getAttribute('href') === targetHash));
Â  Â  Â  Â  Â  Â  Â  Â  sidebarToggle.classList.toggle('hidden', targetHash !== '#chat');
Â  Â  Â  Â  Â  Â  Â  Â  window.history.pushState(null, '', targetHash);
Â  Â  Â  Â  Â  Â  Â  Â  mobileMenu.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  if (targetHash === '#home') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!typingAnimationTimeout && currentHeroCharIndex === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  heroTitle.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  runTypingAnimation();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (currentHeroCharIndex === heroText.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  heroTitle.innerHTML = heroText + '<span class="typing-cursor"></span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stopTypingAnimation();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function addMessage(message, sender = 'ai', options = {}) {
Â  Â  Â  Â  Â  Â  Â  Â  const wrapper = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  wrapper.className = `chat-message flex ${sender === 'user' ? 'justify-end' : ''} ${sender === 'system' ? 'justify-center' : ''}`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const bubble = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  bubble.className = `relative group p-3 rounded-2xl max-w-[80%] ${sender}-bubble ${sender === 'user' ? 'dark:text-gray-900' : ''}`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const contentDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.className = 'message-content';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // If there's a text message, parse and add it
Â  Â  Â  Â  Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.innerHTML = marked.parse(message);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // **FIX STARTS HERE**: Check for an image URL in options and append the image
Â  Â  Â  Â  Â  Â  Â  Â  if (options.imageUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageElement = document.createElement('img');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageElement.src = options.imageUrl;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageElement.alt = options.imageAlt || 'Generated image';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add some styling to the image
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageElement.className = 'mt-2 rounded-lg max-w-full h-auto shadow-md';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.appendChild(imageElement);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // **FIX ENDS HERE**

Â  Â  Â  Â  Â  Â  Â  Â  bubble.appendChild(contentDiv);

Â  Â  Â  Â  Â  Â  Â  Â  if (sender === 'ai') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const buttonContainer = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttonContainer.className = 'absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pdfButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pdfButton.className = 'pdf-button p-1 rounded-full shadow-md bg-white hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pdfButton.title = 'Download as PDF';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pdfButton.innerHTML = `<svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttonContainer.appendChild(pdfButton);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message.includes('```html') && !options.imageUrl) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const previewButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewButton.className = 'p-1 rounded-full shadow-md bg-white hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewButton.title = 'Run in Preview';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewButton.innerHTML = `<svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttonContainer.appendChild(previewButton);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bubble.appendChild(buttonContainer);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.appendChild(bubble);
Â  Â  Â  Â  Â  Â  Â  Â  chatBox.appendChild(wrapper);

Â  Â  Â  Â  Â  Â  Â  Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  return bubble;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function typeOutResponse(bubble, text) {
Â  Â  Â  Â  Â  Â  Â  Â  const contentDiv = bubble.querySelector('.message-content');
Â  Â  Â  Â  Â  Â  Â  Â  let i = 0;
Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.innerHTML = ""; // Clear initial content
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const typingInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (i < text.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.innerHTML = marked.parse(text.substring(0, i + 1) + '<span class="typing-cursor"></span>');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  i++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(typingInterval);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.innerHTML = marked.parse(text); // Final render without cursor
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- Add Copy Buttons and Render Math/Code AFTER typing ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const codeBlocks = bubble.querySelectorAll('pre');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  codeBlocks.forEach(pre => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const copyButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.className = 'copy-code-button';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.innerHTML = `<svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1.5M9 3v2m6-2v2m6 11V7a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2h2m4-2h2M9 13h10a2 2 0 012 2v4a2 2 0 01-2 2H9a2 2 0 01-2-2v-4a2 2 0 012-2z" /></svg> <span>Copy</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pre.appendChild(copyButton);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Prism.highlightAllUnder(bubble);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMathInElement(bubble, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false} ]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, 20); // Adjust typing speed here (milliseconds)
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  function showTypingIndicator() {
Â  Â  Â  Â  Â  Â  Â  Â  const typingIndicator = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  typingIndicator.id = 'typing-indicator';
Â  Â  Â  Â  Â  Â  Â  Â  typingIndicator.className = 'chat-message flex';
Â  Â  Â  Â  Â  Â  Â  Â  typingIndicator.innerHTML = `<div class="p-3 rounded-lg ai-bubble ai-typing-indicator"><span class="inline-block w-2 h-2 bg-[color:var(--primary-accent)] rounded-full mr-1"></span><span class="inline-block w-2 h-2 bg-[color:var(--primary-accent)] rounded-full mr-1"></span><span class="inline-block w-2 h-2 bg-[color:var(--primary-accent)] rounded-full"></span></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  chatBox.appendChild(typingIndicator);
Â  Â  Â  Â  Â  Â  Â  Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  return typingIndicator;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function getAIResponse(history) {
Â  Â  Â  Â  Â  Â  Â  Â  abortController = new AbortController();
Â  Â  Â  Â  Â  Â  Â  Â  const signal = abortController.signal;
Â  Â  Â  Â  Â  Â  Â  Â  const isPreview = window.location.hostname.includes('localhost') || window.location.hostname.includes('usercontent.goog');
Â  Â  Â  Â  Â  Â  Â  Â  const payload = { contents: history, systemInstruction: { parts: [{ text: systemPrompt }] } };
Â  Â  Â  Â  Â  Â  Â  Â  let apiUrl, fetchOptions;
Â  Â  Â  Â  Â  Â  Â  Â  if (isPreview) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tempApiKey = ""; // Add API key for local testing
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${tempApiKey}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchOptions = { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload), signal };
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  apiUrl = new URL('/api/generate', window.location.origin).toString();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchOptions = { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload), signal };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiUrl, fetchOptions);
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error(`API error: ${response.statusText}`);
Â  Â  Â  Â  Â  Â  Â  Â  return await response.json();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function handleSendMessage() {
Â  Â  Â  Â  Â  Â  Â  Â  const message = chatInput.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if (!message && !attachedFile) return;
Â  Â  Â  Â  Â  Â  Â  Â  addMessage(attachedFile ? `[Image Attached] ${message}` : message, 'user');
Â  Â  Â  Â  Â  Â  Â  Â  chatInput.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  chatInput.dispatchEvent(new Event('input'));
Â  Â  Â  Â  Â  Â  Â  Â  const typingIndicator = showTypingIndicator();
Â  Â  Â  Â  Â  Â  Â  Â  toggleStopButton(true);
Â  Â  Â  Â  Â  Â  Â  Â  const currentChat = allChats.find(c => c.id === currentChatId);
Â  Â  Â  Â  Â  Â  Â  Â  const userParts = [];
Â  Â  Â  Â  Â  Â  Â  Â  if (message) userParts.push({ text: message });
Â  Â  Â  Â  Â  Â  Â  Â  if (attachedFile) userParts.push({ inlineData: { mimeType: attachedFile.mimeType, data: attachedFile.base64Data } });
Â  Â  Â  Â  Â  Â  Â  Â  currentChat.history.push({ role: "user", parts: userParts });
Â  Â  Â  Â  Â  Â  Â  Â  saveAllChats();
Â  Â  Â  Â  Â  Â  Â  Â  clearAttachment();
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await getAIResponse(currentChat.history);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typingIndicator.remove(); // Remove indicator once response is received
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (result.candidates && result.candidates.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const aiResponse = result.candidates[0].content.parts[0].text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const aiBubble = addMessage("", 'ai'); // Create an empty bubble first
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typeOutResponse(aiBubble, aiResponse); // Type out the response
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChat.history.push({ role: "model", parts: [{ text: aiResponse }] });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(currentChat.title === "New Chat" && message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChat.title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderChatHistorySidebar();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveAllChats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage("I'm having a little trouble thinking right now. Could you try asking again? ğŸ˜…", 'ai');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error.name !== 'AbortError') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching AI response:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage("Oh no! Something went wrong with my circuits. Please give me a moment and try again. ğŸ’–", 'ai');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â typingIndicator.remove();
Â  Â  Â  Â  Â  Â  _Â _ Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleStopButton(false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  async function generateImage() {
Â  Â  Â  Â  Â  Â  Â  Â  const prompt = chatInput.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if (!prompt) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage("System: Please type a prompt in the input field to generate an image.", 'system');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  let usage = JSON.parse(localStorage.getItem('alaraImageUsage')) || { count: 0, resetTime: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  const now = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  if (now > usage.resetTime) usage = { count: 0, resetTime: now + 3600 * 1000 };
Â  Â  Â  Â  Â  Â  Â  Â  if (usage.count >= 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage("System: You have reached your image generation limit of 5 images per hour. Please try again later.", 'system');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  addMessage("[Image Request] " + prompt, 'user');
Â  Â  Â  Â  Â  Â  Â  Â  chatInput.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  chatInput.dispatchEvent(new Event('input'));
Â  Â  Â  Â  Â  Â  Â  Â  const typingIndicator = showTypingIndicator();
Â  Â  Â  Â  Â  Â  Â  Â  generateImageButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  sendButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch("/api/imagine", {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ prompt }),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok && data.imageUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  usage.count++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('alaraImageUsage', JSON.stringify(usage));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage(`Here's your image based on: "${prompt}"`, 'ai', { imageUrl: data.imageUrl, imageAlt: prompt });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentChat = allChats.find(c => c.id === currentChatId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChat.history.push({ role: "user", parts: [{ text: `[Image Request] ${prompt}` }] });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChat.history.push({ role: "model", parts: [{ text: `Image generated: ${data.imageUrl}` }] });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveAllChats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage(`System: ${data.error || "Failed to generate image. Please try again."}`, 'system');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error generating image:", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage(`System: An unexpected error occurred during image generation: ${err.message}`, 'system');
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typingIndicator.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  generateImageButton.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendButton.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // --- Event Listeners & UI Handlers ---
Â  Â  Â  Â  Â  Â  navLinks.forEach(l => l.addEventListener('click', (e) => { e.preventDefault(); showSection(l.getAttribute('href')); }));
Â  Â  Â  Â  Â  Â  mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
Â  Â  Â  Â  Â  Â  sidebarToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
Â  Â  Â  Â  Â  Â  closeSidebarButton.addEventListener('click', () => sidebar.classList.remove('open'));
Â  Â  Â  Â  Â  Â  sendButton.addEventListener('click', handleSendMessage);
Â  Â  Â  Â  Â  Â  chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); } });
Â  Â  Â  Â  Â  Â  chatInput.addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  Â  Â  chatInput.style.height = 'auto';
Â  Â  Â  Â  Â  Â  Â  Â  chatInput.style.height = `${chatInput.scrollHeight}px`;
Â  Â  Â  Â  Â  Â  Â  Â  if (charCounter) charCounter.textContent = `${chatInput.value.length} / 1500`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  uploadImageButton.addEventListener('click', () => imageInput.click());
Â  Â  Â  Â  Â  Â  imageInput.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onloadend = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attachedFile = { base64Data: reader.result.split(',')[1], mimeType: file.type, name: file.name };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderImagePreview();
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  function renderImagePreview() {
Â  Â  Â  Â  Â  Â  Â  Â  if (!attachedFile) return;
Â  Â  Â  Â  Â  Â  Â  Â  imagePreviewContainer.innerHTML = `<div class="relative inline-block"><img src="data:${attachedFile.mimeType};base64,${attachedFile.base64Data}" class="h-16 w-16 object-cover rounded-lg"><button id="remove-image-btn" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-6 w-6 flex items-center justify-center">&times;</button></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('remove-image-btn').addEventListener('click', clearAttachment);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function clearAttachment() {
Â  Â  Â  Â  Â  Â  Â  Â  attachedFile = null;
Â  Â  Â  Â  Â  Â  Â  Â  imagePreviewContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  imageInput.value = '';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  chatBox.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const target = e.target.closest('button');
Â  Â  Â  Â  Â  Â  Â  Â  if (!target) return;

Â  Â  Â  Â  Â  Â  Â  Â  const messageBubble = target.closest('.chat-message > div');
Â  Â  Â  Â  Â  Â  Â  Â  if (!messageBubble) return;

Â  Â  Â  Â  Â  Â  Â  Â  if (target.matches('.pdf-button')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const content = messageBubble.querySelector('.message-content').innerText;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const doc = new jsPDF();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const margins = { top: 20, bottom: 20, left: 20, right: 20 };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const maxWidth = doc.internal.pageSize.getWidth() - margins.left - margins.right;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lineHeight = 7;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textLines = doc.splitTextToSize(content, maxWidth);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let y = margins.top;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textLines.forEach(line => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (y + lineHeight > doc.internal.pageSize.getHeight() - margins.bottom) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doc.addPage();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y = margins.top;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doc.text(line, margins.left, y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y += lineHeight;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doc.save('alara-response.pdf');
Â  Â  Â  Â  Â  Â  Â  Â  } else if (target.matches('.copy-code-button')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const codeBlock = target.closest('pre')?.querySelector('code');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (codeBlock) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(codeBlock.innerText).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const originalHTML = target.innerHTML;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.innerHTML = `<svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg> <span>Copied!</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.classList.add('copied');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.innerHTML = originalHTML;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target.classList.remove('copied');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).catch(err => console.error('Failed to copy text:', err));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else if (target.matches('[title="Run in Preview"]')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const codeBlock = messageBubble.querySelector('pre code');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (codeBlock) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewIframe.srcdoc = codeBlock.innerText;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewPlaceholder.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewContainer.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showSection('#preview');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  generateImageButton.addEventListener('click', generateImage);

Â  Â  Â  Â  Â  Â  themeToggle.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.toggle('dark');
Â  Â  Â  Â  Â  Â  Â  Â  const isDark = document.body.classList.contains('dark');
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('alaraTheme', isDark ? 'dark' : 'light');
Â  Â  Â  Â  Â  Â  Â  Â  updateThemeIcons(isDark);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  function updateThemeIcons(isDark) {
Â  Â  Â  Â  Â  Â  Â  Â  themeIconLight.classList.toggle('hidden', isDark);
Â  Â  Â  Â  Â  Â  Â  Â  themeIconDark.classList.toggle('hidden', !isDark);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function toggleStopButton(isThinking) {
Â  Â  Â  Â  Â  Â  Â  Â  if (isThinking) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendButton.innerHTML = `<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendButton.onclick = () => { abortController.abort(); toggleStopButton(false); };
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendButton.innerHTML = `<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendButton.onclick = handleSendMessage;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function saveAllChats() {
Â  Â  Â  Â  Â  Â  Â  Â  try { localStorage.setItem('alaraAllChats', JSON.stringify(allChats)); } catch (e) { console.error("Could not save chat history:", e); }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function loadAllChats() {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const savedChats = localStorage.getItem('alaraAllChats');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allChats = savedChats ? JSON.parse(savedChats) : [];
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Could not parse chat history:", e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allChats = [];
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function loadChat(chatId) {
Â  Â  Â  Â  Â  Â  Â  Â  const chat = allChats.find(c => c.id === chatId);
Â  Â  Â  Â  Â  Â  Â  Â  if (!chat) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (allChats.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadChat(allChats[0].id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startNewChat();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = chat.id;
Â  Â  Â  Â  Â  Â  Â  Â  chatBox.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  chat.history.forEach(msg => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textPart = msg.parts.find(p => p.text)?.text || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageMatch = textPart.match(/^Image generated: (https:\/\/[^\s]+)$/);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (imageMatch && msg.role === 'model') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessage(`Here's your image:`, 'ai', { imageUrl: imageMatch[1], imageAlt: 'Generated image' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const bubble = addMessage(textPart, msg.role);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Post-render processing for loaded messages
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const codeBlocks = bubble.querySelectorAll('pre');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  codeBlocks.forEach(pre => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const copyButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.className = 'copy-code-button';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.innerHTML = `<svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1.5M9 3v2m6-2v2m6 11V7a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2h2m4-2h2M9 13h10a2 2 0 012 2v4a2 2 0 01-2 2H9a2 2 0 01-2-2v-4a2 2 0 012-2z" /></svg> <span>Copy</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pre.appendChild(copyButton);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Prism.highlightAllUnder(bubble);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMathInElement(bubble, { delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false} ] });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  sidebar.classList.remove('open');
Â  Â  Â  Â  Â  Â  Â  Â  renderChatHistorySidebar();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function startNewChat() {
Â  Â  Â  Â  Â  Â  Â  Â  const newChat = { id: Date.now().toString(), title: "New Chat", history: [] };
Â  Â  Â  Â  Â  Â  Â  Â  allChats.unshift(newChat);
Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = newChat.id;
Â  Â  Â  Â  Â  Â  Â  Â  saveAllChats();
Â  Â  Â  Â  Â  Â  Â  Â  loadChat(currentChatId);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  newChatButton.addEventListener('click', startNewChat);

Â  Â  Â  Â  Â  Â  function renderChatHistorySidebar() {
Â  Â  Â  Â  Â  Â  Â  Â  chatHistoryList.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  allChats.forEach(chat => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'p-3 rounded-lg cursor-pointer flex justify-between items-center text-sm font-medium hover:bg-[color:var(--secondary-accent)]/20 dark:hover:bg-[color:var(--primary-accent)]/20 transition-colors duration-200';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.toggle('bg-[color:var(--secondary-accent)]/30', chat.id === currentChatId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.toggle('dark:bg-[color:var(--primary-accent)]/30', chat.id === currentChatId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `<span class="truncate pr-2 flex-1">${chat.title}</span><div class="flex-shrink-0 flex space-x-2"><button class="rename-btn p-1 rounded-full hover:bg-white/30 dark:hover:bg-black/30 text-gray-600 dark:text-gray-300 transition-colors">âœï¸</button><button class="delete-btn p-1 rounded-full hover:bg-white/30 dark:hover:bg-black/30 text-red-500 transition-colors">ğŸ—‘ï¸</button></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.onclick = () => loadChat(chat.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.querySelector('.rename-btn').onclick = (e) => { e.stopPropagation(); renameChat(chat.id); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.querySelector('.delete-btn').onclick = (e) => { e.stopPropagation(); deleteChat(chat.id); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatHistoryList.appendChild(item);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function renameChat(chatId) {
Â  Â  Â  Â  Â  Â  Â  Â  const chat = allChats.find(c => c.id === chatId);
Â  Â  Â  Â  Â  Â  Â  Â  const newTitle = prompt("Enter new chat title:", chat.title);
Â  Â  Â  Â  Â  Â  Â  Â  if(newTitle && newTitle.trim() !== '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.title = newTitle.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveAllChats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderChatHistorySidebar();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function deleteChat(chatId) {
Â  Â  Â  Â  Â  Â  Â  Â  if(confirm("Are you sure you want to delete this chat?")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allChats = allChats.filter(c => c.id !== chatId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveAllChats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(currentChatId === chatId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = null; // Unset current chat ID
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(allChats.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadChat(allChats[0].id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startNewChat();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderChatHistorySidebar();
Â  Â  Â  _ Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function initialize() {
Â  Â  Â  Â  Â  Â  Â  Â  const savedTheme = localStorage.getItem('alaraTheme');
Â  Â  Â  Â  Â  Â  Â  Â  if (savedTheme === 'dark') document.body.classList.add('dark');
Â  Â  Â  Â  Â  Â  Â  Â  updateThemeIcons(savedTheme === 'dark');
Â  Â  Â  Â  Â  Â  Â  Â  const currentHash = window.location.hash;
Â  Â  Â  Â  Â  Â  Â  Â  showSection(currentHash || '#home');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  loadAllChats(); // Load history first
Â  Â  Â  Â  Â  Â  Â  Â  startNewChat(); // Then create a new chat for the session
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  initialize();
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
